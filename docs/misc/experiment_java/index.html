<!DOCTYPE html>
<html>
    <head>
        <title>Particules detection</title>
        <script src="jspsych-6.1.0/jspsych.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-image-button-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-survey-multi-choice.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="ImageMapster-master/dist/jquery.imagemapster.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-causal-graph-inactive.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-causal-graph.js"></script>
        <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    </head>
    <body>

        <!-- ####################### Heading ####################### -->
	    <a name="top"></a>
	    <h1 style="text-align:center; width:1200px" id="header" class="header">&nbsp; UniMelb Computational Cognitive Science Lab</h1>


        <!-- ####################### Start page ####################### -->

        <div class="start" style="width: 1000px">
            <!-- Text box for the splash page -->
            <div class="start" style="text-align:left; border:0px solid; padding:10px;  width:800px; float:right; font-size:90%">
                <p>Thanks for accepting to participate to our experiment. <b>"Particules detection"</b> is a short psychological study investigating how people make causal judgments. It involves
                    the following steps:</p>
                <ol>
                    <li> We ask for demographic information (not connected to your Amazon ID)<br></li>
                    <li> Because this is a University research project, we ask for your informed consent. (The format of the consent form is a standard university document, so it sometimes looks a little weird on MTurk)<br></li>
                    <li> The study then explains how to do the task in detail. You will need to pass a short test to
                        check that you understand how the study works.<br></li>
                    <li> Next comes the experiment itself.<br></li>
                    <li> At the end, we'll give you the completion code you need to get paid for the HIT.</li>
                </ol>
                <p>
                    The total time taken should be about 5 minutes. Please <u>don't</u> use the "back" button on
                    your browser or close the window until you reach the end and receive your completion code.
                    This is very likely to break the experiment and may make it difficult for you to get paid.
                    However, if something does go wrong, please contact us! When you're ready to begin, click
                    on the "start" button below.</p>

            <!-- Next button for the splash page -->
                <p align="center"> <input type="button" id="splashButton" class="start jspsych-btn" value="Start!"
                        onclick="splashButtonClick()"> </p>

                </div>
        </div>
        
        	<!-- ####################### Consent ####################### -->
	<div class="consent" style="display:none; width:1000px">
		<!-- Text box for the splash page -->
		<div class="consent" style="text-align:left; border:0px solid; padding:10px;  width:800px; font-size:90%; float:right">

			<p align="right">Approval No ?</p>


			<p align="center"><b>THE UNIVERSITY OF MELBOURNE<br>
			PARTICIPANT INFORMATION STATEMENT</b><br><br>
			Theories of causal reasoning
			</p>

			<p><b>Participant Selection and Purpose of Study</b></p>
			<p>You are invited to participate in a study of how human makes causal judgments. The goal of the study is to understand better how people determine the 
                cause or causes of an effect. You were selected as a possible participant in this study because you accepted our HIT on Amazon Mechanical Turk.</p>

			<p><b>Description of Study and Risks</b></p>
			<p>If you decide to participate you will be presented animated graphs which will represent chains of connected cells being activated. You will have to 
                click on the cell or cells that you will consider as the cause or causes of the activation of the final cell, and to rank them if you judge that some cells cause the 
                final effect more than others. Detailed instructions will be provided once the task begins. The different graphs will be displayed randomly. The task should 
                take approximately 5 minutes to complete including reading time.</p>

			<p>No discomforts or inconveniences besides some boredom are reasonably expected. No risks are reasonably expected as a result of your participation in this study. We cannot and do not guarantee or promise that you will receive any benefits from this study.</p>

			<p><b>Confidentiality and Disclosure of Information</b></p>
			<p>Any information that is obtained in connection with this study and that can be identified with you will remain confidential and will be disclosed only with your permission or except as required by law.  If you give us your permission by clicking on the “I agree” button below, we plan to publish the results in academic journals and discuss the results at scientific conferences. In any publication, information will be provided in such a way that you cannot be identified.</p>

			<p><b>Recompense to participants</b></p>
			<p>As stated on the Amazon Mechanical Turk page, the pay for completing this HIT is <b>US$0.85.</b></p>

			<p><b>Your consent</b></p>
			<p>Your decision whether or not to participate will not prejudice your future relations with The University of Melbourne.  If you decide to participate, you are free to withdraw your consent and to discontinue participation at any time without prejudice.</p>

			<p><b>Inquiries</b></p>
			<p>If you have any questions or concerns following your participation, Associate Professor Charles Kemp (...) will be happy to address them. Complaints about the study may be directed to UniMelb’s Research Ethics and Compliance Support, (phone ..., email. ...).<p>

			<p>Please keep a copy of this information sheet (you can download the pdf <a href="./wtf/info.pdf" target="_blank">here</a>)</p>

			<br>
			<p align="center"><b>PARTICIPANT CONSENT</b></p>

			By continuing, you are making a decision whether or not to participate.  Clicking the button below indicates that, having read the information provided on the participant information sheet, you have decided to participate.

			<br>
			<p align="center">
                <input type="button" id="consentButton" class="consent jspsych-btn" value="I agree" onclick="consentButtonClick()" >
			</p>


			<p>To withdraw your consent, simply close the browser tab and return the HIT. Your data will be deleted from our records.</p>
		</div>
        <br><br>
	</div>


        	<!-- ####################### Demographics ####################### -->

	<div class="demographics" style="display:none; align:center; width: 1000px">
		<div class="demographics" style="text-align:left; border:0px solid; padding:10px;  width:800px; font-size:90%; float:right">
			<!-- Explanatory text -->
            <p font-size:110%><b>Demographic information:</b></p>
			<p>
                We need this information for our records, but it is kept completely separate from
                information about your Amazon ID. As long as you finish the experiment you will get
                paid no matter what you put here, so please be honest.
            </p><br>

			<!-- Gender -->
	 		<label for="gender"><b>Gender: &nbsp;</b></label>
	  		<input type="radio" name="gender" value="male" /> Male &nbsp;
	  		<input type="radio" name="gender" value="female" /> Female &nbsp;
	  		<input type="radio" name="gender" value="other" /> Other<br /><br />

			<!-- Age -->
	  		<label for="age"><b>Age: &nbsp;</b></label><input id="age" name="age" /><br /><br />

			<!-- Language -->
	  		<label for="language"><b>Native Language(s): &nbsp;</b></label>
            <input id="language" name="language" /><br /><br />

			<!-- Country -->
			<label for="country"><b>Country you live in: &nbsp;</b></label>
	  		<select name="country" id="country" class='drop-menu'>
	    		<option>Afghanistan</option>
                <option>&Aring;land Islands</option>
                <option>Albania</option>
                <option>Algeria</option>
                <option>American Samoa</option>
                <option>Andorra</option>
                <option>Angola</option>
                <option>Anguilla</option>
                <option>Antarctica</option>
                <option>Antigua and Barbuda</option>
                <option>Argentina</option>
                <option>Armenia</option>
                <option>Aruba</option>
                <option>Australia</option>
                <option>Austria</option>
                <option>Azerbaijan</option>
                <option>Bahamas</option>
                <option>Bahrain</option>
                <option>Bangladesh</option>
                <option>Barbados</option>
                <option>Belarus</option>
                <option>Belgium</option>
                <option>Belize</option>
                <option>Benin</option>
                <option>Bermuda</option>
                <option>Bhutan</option>
                <option>Bolivia</option>
                <option>Bosnia and Herzegovina</option>
                <option>Botswana</option>
                <option>Bouvet Island</option>
                <option>Brazil</option>
                <option>British Indian Ocean territory</option>
                <option>Brunei Darussalam</option>
                <option>Bulgaria</option>
                <option>Burkina Faso</option>
                <option>Burundi</option>
                <option>Cambodia</option>
                <option>Cameroon</option>
                <option>Canada</option>
                <option>Cape Verde</option>
                <option>Cayman Islands</option>
                <option>Central African Republic</option>
                <option>Chad</option>
                <option>Chile</option>
                <option>China</option>
                <option>Christmas Island</option>
                <option>Cocos (Keeling) Islands</option>
                <option>Colombia</option>
                <option>Comoros</option>
                <option>Congo</option>
                <option>Congo, Democratic Republic</option>
                <option>Cook Islands</option>
                <option>Costa Rica</option>
                <option>C&ocirc;te d'Ivoire (Ivory Coast)</option>
                <option>Croatia (Hrvatska)</option>
                <option>Cuba</option>
                <option>Cyprus</option>
                <option>Czech Republic</option>
                <option>Denmark</option>
                <option>Djibouti</option>
                <option>Dominica</option>
                <option>Dominican Republic</option>
                <option>East Timor</option>
                <option>Ecuador</option>
                <option>Egypt</option>
                <option>El Salvador</option>
                <option>Equatorial Guinea</option>
                <option>Eritrea</option>
                <option>Estonia</option>
                <option>Ethiopia</option>
                <option>Falkland Islands</option>
                <option>Faroe Islands</option>
                <option>Fiji</option>
                <option>Finland</option>
                <option>France</option>
                <option>French Guiana</option>
                <option>French Polynesia</option>
                <option>French Southern Territories</option>
                <option>Gabon</option>
                <option>Gambia</option>
                <option>Georgia</option>
                <option>Germany</option>
                <option>Ghana</option>
                <option>Gibraltar</option>
                <option>Greece</option>
                <option>Greenland</option>
                <option>Grenada</option>
                <option>Guadeloupe</option>
                <option>Guam</option>
                <option>Guatemala</option>
                <option>Guinea</option>
                <option>Guinea-Bissau</option>
                <option>Guyana</option>
                <option>Haiti</option>
                <option>Heard and McDonald Islands</option>
                <option>Honduras</option>
                <option>Hong Kong</option>
                <option>Hungary</option>
                <option>Iceland</option>
                <option>India</option>
                <option>Indonesia</option>
                <option>Iran</option>
                <option>Iraq</option>
                <option>Ireland</option>
                <option>Israel</option>
                <option>Italy</option>
                <option>Jamaica</option>
                <option>Japan</option>
                <option>Jordan</option>
                <option>Kazakhstan</option>
                <option>Kenya</option>
                <option>Kiribati</option>
                <option>Korea (north)</option>
                <option>Korea (south)</option>
                <option>Kuwait</option>
                <option>Kyrgyzstan</option>
                <option>Lao People's Democratic Republic</option>
                <option>Latvia</option>
                <option>Lebanon</option>
                <option>Lesotho</option>
                <option>Liberia</option>
                <option>Libyan Arab Jamahiriya</option>
                <option>Liechtenstein</option>
                <option>Lithuania</option>
                <option>Luxembourg</option>
                <option>Macao</option>
                <option>Macedonia, Former Yugoslav Republic Of</option>
                <option>Madagascar</option>
                <option>Malawi</option>
                <option>Malaysia</option>
                <option>Maldives</option>
                <option>Mali</option>
                <option>Malta</option>
                <option>Marshall Islands</option>
                <option>Martinique</option>
                <option>Mauritania</option>
                <option>Mauritius</option>
                <option>Mayotte</option>
                <option>Mexico</option>
                <option>Micronesia</option>
                <option>Moldova</option>
                <option>Monaco</option>
                <option>Mongolia</option>
                <option>Montenegro</option>
                <option>Montserrat</option>
                <option>Morocco</option>
                <option>Mozambique</option>
                <option>Myanmar</option>
                <option>Namibia</option>
                <option>Nauru</option>
                <option>Nepal</option>
                <option>Netherlands</option>
                <option>Netherlands Antilles</option>
                <option>New Caledonia</option>
                <option>New Zealand</option>
                <option>Nicaragua</option>
                <option>Niger</option>
                <option>Nigeria</option>
                <option>Niue</option>
                <option>Norfolk Island</option>
                <option>Northern Mariana Islands</option>
                <option>Norway</option>
                <option>Oman</option>
                <option>Pakistan</option>
                <option>Palau</option>
                <option>Palestinian Territories</option>
                <option>Panama</option>
                <option>Papua New Guinea</option>
                <option>Paraguay</option>
                <option>Peru</option>
                <option>Philippines</option>
                <option>Pitcairn</option>
                <option>Poland</option>
                <option>Portugal</option>
                <option>Puerto Rico</option>
                <option>Qatar</option>
                <option>R&eacute;union</option>
                <option>Romania</option>
                <option>Russian Federation</option>
                <option>Rwanda</option>
                <option>Saint Helena</option>
                <option>Saint Kitts and Nevis</option>
                <option>Saint Lucia</option>
                <option>Saint Pierre and Miquelon</option>
                <option>Saint Vincent and the Grenadines</option>
                <option>Samoa</option>
                <option>San Marino</option>
                <option>Sao Tome and Principe</option>
                <option>Saudi Arabia</option>
                <option>Senegal</option>
                <option>Serbia</option>
                <option>Seychelles</option>
                <option>Sierra Leone</option>
                <option>Singapore</option>
                <option>Slovakia</option>
                <option>Slovenia</option>
                <option>Solomon Islands</option>
                <option>Somalia</option>
                <option>South Africa</option>
                <option>South Georgia and the South Sandwich Islands</option>
                <option>Spain</option>
                <option>Sri Lanka</option>
                <option>Sudan</option>
                <option>Suriname</option>
                <option>Svalbard and Jan Mayen Islands</option>
                <option>Swaziland</option>
                <option>Sweden</option>
                <option>Switzerland</option>
                <option>Syria</option>
                <option>Taiwan</option>
                <option>Tajikistan</option>
                <option>Tanzania</option>
                <option>Thailand</option>
                <option>Togo</option>
                <option>Tokelau</option>
                <option>Tonga</option>
                <option>Trinidad and Tobago</option>
                <option>Tunisia</option>
                <option>Turkey</option>
                <option>Turkmenistan</option>
                <option>Turks and Caicos Islands</option>
                <option>Tuvalu</option>
                <option>Uganda</option>
                <option>Ukraine</option>
                <option>United Arab Emirates</option>
                <option>United Kingdom</option>
                <option selected="selected">United States of America</option>
                <option>Uruguay</option>
                <option>Uzbekistan</option>
                <option>Vanuatu</option>
                <option>Vatican City</option>
                <option>Venezuela</option>
                <option>Vietnam</option>
                <option>Virgin Islands (British)</option>
                <option>Virgin Islands (US)</option>
                <option>Wallis and Futuna Islands</option>
                <option>Western Sahara</option>
                <option>Yemen</option>
                <option>Zaire</option>
                <option>Zambia</option>
                <option>Zimbabwe</option>
	    	</select>

			<br>
		<br>

		<!-- Demographics  button -->
        <p align="center">
                <input type="button" class="demographics jspsych-btn" id="demographicsButton" value="Next >"
                       onclick="demographicsButtonClick()">
       </p>
	</div>

    </body>
    <script>

    var timeline = [];
    var introloop=[];

    function setDisplay(theClass, theValue) {
            var i, classElements = document.getElementsByClassName(theClass);
            for (i = 0; i < classElements.length; i = i + 1) {
                classElements[i].style.display = theValue;
            }
        }

    function setHeader(theValue) {
        document.getElementById("header").innerText = theValue;
    }

    function splashButtonClick() {
            setDisplay('start', 'none');
            setDisplay('consent', '');
            setHeader(' ');
        }

    function consentButtonClick() {
        setDisplay('consent', 'none');
        setDisplay('demographics', '');
        setHeader(' ');
    }

    function startExperiment(){
    
        jsPsych.init({
            timeline: timeline,
            preload_images: [gif,img]/*,
            on_finish: function() {
                jsPsych.data.displayData();
            }*/
        });

    }

    function demographicsButtonClick() {
            setDisplay('demographics', 'none');
            setDisplay('header','none')

            startExperiment();
        }

    var instructions = {
          type: "image-button-response",
          timing_post_trial: 0,
	      button_html: '<button class="jspsych-btn">%choice%</button>',
          choices: ['Click here to continue'],
          //on_trial_start: function() { setTimeout(function() {setDisplay("jspsych-btn","")}, 3000)},
          is_html: true,
          timeline: [
              {stimulus: "img/inst_1.png"},
              {stimulus: "img/inst_2.png"},
              {stimulus: "img/inst_3.png"},
              //{stimulus: "img/inst_4.png"},
              {stimulus: "img/inst_4.gif"},
              {stimulus: "img/inst_5.png"},
              {stimulus: "img/inst_6.png"},
              {stimulus: "img/inst_7.png"},
          ]
      };
    introloop.push(instructions);

    
    //var instructioncorrect = false;
    var instructioncorrect = false;
    var instruction_check1 = {
        type: "survey-multi-choice",
        preamble: ["<p align='center'><b>Check your knowledge before you begin !</b></p>"],
        button_label: "Submit Answers",
        questions: [
            {prompt:"<b>Question 1</b>: What is your goal in this task ?", options:[" To find out if the Gauge of Crtical Moment (GCM) is activated or not"," To find out the cause of the activation of each detector"," To find out which detector(s) cause(s) the activation of a GCM"],required:true},
            {prompt:"<b>Question 2</b>: How to recognize a GCM ?", options:[" A GCM is a square marked with a star", "A GCM is a square without any mark"],required:true},
            {prompt:"<b>Question 3</b>: What is the difference between a GCM-chain and a GCM-branch ?", options:[" To be activated a GCM-chain has to receive signals from only one inactive detector whereas a GCM-branch from necessarily two inactive detectors"," To be activated a GCM-chain has to receive signals from necessarily two activated detectors whereas a GCM-branch from only one activated detector"," To be activated a GCM-chain has to receive signals from only one activated detector whereas a GCM-branch from necessarily two activated detectors"],required:true},
            {prompt:"<b>Question 4</b>: Stick the correct statement", options:[" You are required to assign a number to each detector"," You can pick just one detector as the unique or main cause, or you can pick several detectors and rank them"," Two detectors cannot be given the same rank"],required:true}
        ],
        on_finish: function(data) {

            if( data.responses == '{"Q0":" To find out which detector(s) cause(s) the activation of a GCM","Q1":" A GCM is a square marked with a star","Q2":" To be activated a GCM-chain has to receive signals from only one activated detector whereas a GCM-branch from necessarily two activated detectors","Q3":" You can pick just one detector as the unique or main cause, or you can pick several detectors and rank them"}') {
                action = false;
                instructioncorrect = true;
            }

            //console.log(hack)
        }
    }
    introloop.push(instruction_check1)

    
    var width = 605;
    var height = 529;

    
    var instruction_check2 = {
        type: 'causal-graph',
        stimulus: "img/check_click.png",
        stim_width: width,
        stim_height: height,
        nodes_coord: [[132,328],[181,249],[204,407],[260,317],[287,192],[328,434],[366,268],[396,358]],
        button_label_next: "Submit Answers"
    }

    introloop.push(instruction_check2);
    
    var showsplash = true;
    var splash_screen = {
        type: 'image-button-response',
        timing_post_trial: 0,
	    button_html: '<button class="jspsych-btn">%choice%</button>',
        choices: ['Click here to read the instructions again'],
        //on_trial_start: function() { setTimeout(function() {setDisplay("jspsych-btn","")}, 1000)},
        is_html: true,
        stimulus: 'img/inst_8.png'
    }

    var conditional_splash = {
        timeline: [splash_screen],
        conditional_function: function(data) {
            return !instructioncorrect // skip if correct
        }
    }
    introloop.push(conditional_splash)

    var loop_node = {
        timeline: introloop,
        loop_function: function(data) {
            //var action = true;
            return !instructioncorrect // stop looping if correct
        }
    }
    timeline.push(loop_node)


    /* success trial */
    var successtrial = {
        type: 'image-button-response',
        timing_post_trial: 0,
	    button_html: '<button class="jspsych-btn">%choice%</button>',
        choices: ['Click here to begin'],
        //on_trial_start: function() { setTimeout(function() {setDisplay("jspsych-btn","")}, 1000)},
        is_html: true,
        stimulus: "img/inst_9.png"
    };
    timeline.push(successtrial);

    var txt_prompt = "Pick out the detector(s) that is (are) the cause(s) of the activation of the GCM (and rank them if you pick several)";
    var coord_chain = [[19,245],[94,245],[170,245],[245,245],[321,245],[396,245],[472,245],[547,245]];
    var coord_branch = [[19,189],[94,189],[170,189],[245,189],[321,189],[396,189],[472,189],[19,302],[94,302],[170,302],[245,302],[321,302],[396,302],[472,302],[547,245]];
    var img = ["img/chain_S0.png", "img/chain_M0.png", "img/chain_L0.png", "img/branch_SS0.png", "img/branch_MS0.png", "img/branch_LS0.png"];
    var gif = ["img/chain_S.gif", "img/chain_M.gif", "img/chain_L.gif", "img/branch_SS.gif", "img/branch_MS.gif", "img/branch_LS.gif"];
    //var gif = ["img/chain_S", "img/chain_M", "img/chain_L", "img/branch_SS", "img/branch_MS", "img/branch_LS"];
    
    var chain_S_img = {
        type: 'causal-graph-inactive',
        stimulus: img[0],
        stim_width: width,
        stim_height: height,
        prompt: txt_prompt
    }
    
    var chain_S_gif = {
        type: 'causal-graph',
        stimulus: gif[0],
        stim_width: width,
        stim_height: height,
        nodes_coord: coord_chain,
        prompt: txt_prompt,
        button_label_again: "Run again",
        button_label_next: "Next graph"
    }

    var chain_S_loop = {
        timeline: [chain_S_gif],
        loop_function: function(data){
            var again = data.values()[0].again;
            if(again == 1){
                return true;
            } else {
                return false;
            }
        }
    }

    var chain_S = [chain_S_img, chain_S_loop];

    var chain_M_img = {
        type: 'causal-graph-inactive',
        stimulus: img[1],
        stim_width: width,
        stim_height: height,
        prompt: txt_prompt
    }

    var chain_M_gif = {
        type: 'causal-graph',
        stimulus: gif[1],
        stim_width: width,
        stim_height: height,
        nodes_coord: coord_chain,
        prompt: txt_prompt,
        button_label_again: "Run again",
        button_label_next: "Next graph"
    }

    var chain_M_loop = {
        timeline: [chain_M_gif],
        loop_function: function(data){
            var again = data.values()[0].again;
            if(again == 1){
                return true;
            } else {
                return false;
            }
        }
    }

    var chain_M = [chain_M_img, chain_M_loop];

    var chain_L_img = {
        type: 'causal-graph-inactive',
        stimulus: img[2],
        stim_width: width,
        stim_height: height,
        prompt: txt_prompt
    }

    var chain_L_gif = {
        type: 'causal-graph',
        stimulus: gif[2],
        stim_width: width,
        stim_height: height,
        nodes_coord: coord_chain,
        prompt: txt_prompt,
        button_label_again: "Run again",
        button_label_next: "Next graph"
    }

    var chain_L_loop = {
        timeline: [chain_L_gif],
        loop_function: function(data){
            var again = data.values()[0].again;
            if(again == 1){
                return true;
            } else {
                return false;
            }
        }
    }

    var chain_L = [chain_L_img, chain_L_loop];

    var branch_SS_img = {
        type: 'causal-graph-inactive',
        stimulus: img[3],
        stim_width: width,
        stim_height: height,
        prompt: txt_prompt
    }

    var branch_SS_gif = {
        type: 'causal-graph',
        stimulus: gif[3],
        stim_width: width,
        stim_height: height,
        nodes_coord: coord_branch,
        prompt: txt_prompt,
        button_label_again: "Run again",
        button_label_next: "Next graph"
    }

    var branch_SS_loop = {
        timeline: [branch_SS_gif],
        loop_function: function(data){
            var again = data.values()[0].again;
            if(again == 1){
                return true;
            } else {
                return false;
            }
        }
    }

    var branch_SS = [branch_SS_img, branch_SS_loop];

    var branch_MS_img = {
        type: 'causal-graph-inactive',
        stimulus: img[4],
        stim_width: width,
        stim_height: height,
        prompt: txt_prompt
    }

    var branch_MS_gif = {
        type: 'causal-graph',
        stimulus: gif[4],
        stim_width: width,
        stim_height: height,
        nodes_coord: coord_branch,
        prompt: txt_prompt,
        button_label_again: "Run again",
        button_label_next: "Next graph"
    }

    var branch_MS_loop = {
        timeline: [branch_MS_gif],
        loop_function: function(data){
            var again = data.values()[0].again;
            if(again == 1){
                return true;
            } else {
                return false;
            }
        }
    }

    var branch_MS = [branch_MS_img, branch_MS_loop];

    var branch_LS_img = {
        type: 'causal-graph-inactive',
        stimulus: img[5],
        stim_width: width,
        stim_height: height,
        prompt: txt_prompt
    }

    var branch_LS_gif = {
        type: 'causal-graph',
        stimulus: gif[5],
        stim_width: width,
        stim_height: height,
        nodes_coord: coord_branch,
        prompt: txt_prompt,
        button_label_again: "Run again",
        button_label_next: "Next graph"
    }

    var branch_LS_loop = {
        timeline: [branch_LS_gif],
        loop_function: function(data){
            var again = data.values()[0].again;
            if(again == 1){
                return true;
            } else {
                return false;
            }
        }
    }

    var branch_LS = [branch_LS_img, branch_LS_loop];

    // var all_trials = [chain_S_loop, chain_M_loop, chain_L_loop, branch_SS_loop, branch_MS_loop, branch_LS_loop];
    var all_trials = [chain_S, chain_M, chain_L, branch_SS, branch_MS, branch_LS];
    var all_trials_rand = jsPsych.randomization.repeat(all_trials, 1);

    for (var i=0; i < all_trials_rand.length; i++) {
        timeline.push(all_trials_rand[i][0]);
        timeline.push(all_trials_rand[i][1]);
    }

    </script>
</html>