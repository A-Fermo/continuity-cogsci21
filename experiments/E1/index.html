<!DOCTYPE html>
<html>
    <head>
        <title>Particules detection</title>
        <script src="Plugins/jspsych.js"></script>
        <script src="Plugins/jspsych-html-button-response.js"></script>
        <script src="Plugins/jspsych-image-button-response.js"></script>
        <script src="Plugins/jspsych-survey-multi-choice.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="Plugins/jquery.imagemapster.js"></script>
        <script src="Plugins/jspsych-causal-graph-inactive.js"></script>
        <script src="Plugins/jspsych-causal-graph1.js"></script>
        <link href="Plugins/jspsych.css" rel="stylesheet" type="text/css"></link>
    </head>
    <body>


        <!-- ####################### Start page ####################### -->

        <div class="start" style="width: 800px; margin:auto;">
            <!-- Text box for the splash page -->
            <div class="start" style="text-align:justify; border:0px solid; padding: 70px 0;  width:800px; float:right; font-size:90%">
                
                <p align="center" style="font-size: 19px;"><b>Computational Cognitive Science Lab<br><br>
                    University of Melbourne</b><br>
                </p>   
                <br><br>
                <p>Thanks for accepting to participate to our experiment. <b>"Particules detection"</b> is a short psychological study investigating how people make causal judgments. It involves
                    the following steps:</p>
                <ol>
                    <li> We ask for demographic information (not connected to your Amazon ID)<br></li>
                    <br>
                    <li> Because this is a University research project, we ask for your informed consent. (The format of the consent form is a standard university document, so it sometimes looks a little weird on MTurk)<br></li>
                    <br>
                    <li> The study then explains how to do the task in detail. You will need to pass a short test to check that you understand how the study works.<br></li>
                    <br>
                    <li> Next comes the experiment itself.<br></li>
                    <br>
                    <li> At the end, we'll give you the completion code you need to get paid for the HIT.</li>
                </ol>
                <p>
                    The total time taken should be about 5 minutes. Please <u>don't</u> use the "back" button on
                    your browser or close the window until you reach the end and receive your completion code.
                    This is very likely to break the experiment and may make it difficult for you to get paid.
                    However, if something does go wrong, please contact us! When you're ready to begin, click
                    on the "start" button below.</p>

                <br><br>

            <!-- Next button for the splash page -->
                <p align="center"> <input type="button" id="splashButton" class="start jspsych-btn" value="Start !"
                        onclick="splashButtonClick()"> </p>

                </div>
        </div>
        
        	<!-- ####################### Consent ####################### -->
	<div class="plain-language-statement" style="display:none; width:800px; margin:auto;">
		<!-- Text box for the splash page -->
		<div class="plain-language-statement" style="text-align:justify; border:0px solid; padding:10px;  width:800px; font-size:90%; float:right">

			<p align="center" style="font-size: 19px;"><img src="img/Unimelb.png" alt="Uni logo" style="float:left;width:97px;height:104px;"><img src="img/Unimelb.png" alt="Uni logo" style="float:right;width:97px;height:104px;"><b>Melbourne School of Psychological Sciences<br><br>
                Plain Language Statement</b><br>
            </p>   

            <p align="center">PROJECT TITLE: <i><b>Identifying causes of events</b></i><br><br>
            </p>      
            <hr/>
            <p align="center"><b>Aurélien Fermo (Responsible Researcher)<br></b>
                Tel: +33 642 249 420; email: aurelien.fermo@ens.fr<br>
                <b>A/Prof Charles Kemp (co-researcher)</b> email: c.kemp@unimelb.edu
			</p>
            <hr/><br>
			<p align="center"><b>Introduction</b></p>
			<p>You are invited to participate in a study of how human makes causal judgments. The goal of this project is to better understand how people determine the cause or causes of an effect.</p>

			<p align="center"><b>What will I be asked to do ?</b></p>
			<p>After answering some optional demographic questions, if you decide to participate, you will be shown animated graphs which will represent activation spreading over networks of detectors. You will have to identify which detector or detectors you consider to be the main cause of the activation of the final cell. Detailed instructions will be provided once the task begins. </p>
            
            <p align="center"><b>What are the risks ?</b></p>
			<p>Risks are minimal.</p>

            <p align="center"><b>What are the benefits ?</b></p>
			<p>This experiment will characterize some of the factors that influence how people identify the causes of an effect. You will be paid for your contribution at a rate of $10/hr.</p>

			<p align="center"><b>How would my confidentiality be protected ?</b></p>
			<p>As an Amazon Worker, we do not have access to identifying personal details. You will be optionally asked to contribute some demographic details but these are optional. Our sample size will be large, making it even more difficult to identify any one person.</p>

			<p align="center"><b>What if I want to withdraw from the Research ?</b></p>
			<p>Participation in this research is completely voluntary. Your data will not be used in the full sample unless you complete the experiment.</p>

			<p align="center"><b>Where can I get further information ?</b></p>
			<p>This research project has been approved by the Human Research Ethics Committee of The University of Melbourne. If you have any concerns or complaints about the conduct of this research project, which you do not wish to discuss with the research team, you should contact the Manager, Human Research Ethics, Research Ethics and Integrity, University of Melbourne, VIC 3010. Tel: +61 3 8344 2073 or Email: humanethics-complaints@unimelb.edu.au. All complaints will be treated confidentially. In any correspondence please provide the name of the research team or the name or ethics ID number of the research project. <p>

			<p>Please keep a copy of this information sheet (you can download the pdf <a href="./wtf/pls.pdf" target="_blank">here</a>)</p>

            <p align="center"><b>How do I agree to participate ?</b></p>
            <p>If you wish to participate please read and click ‘Next’ after reading the consent form on the next page.<p></p>
            
            <br>
			<p align="center">
                <input type="button" id="plsButton" class="pls jspsych-btn" value="Go to consent form" onclick="plsButtonClick()" >
			</p>

		</div>
        <br><br>
    </div>
    
    <div class="consent" style="display:none; width:800px; margin:auto;">
		<!-- Text box for the splash page -->
		<div class="consent" style="text-align:justify; border:0px solid; padding:10px;  width:800px; font-size:90%; float:right">


			<p align="center" style="font-size: 19px;"><img src="img/Unimelb.png" alt="Uni logo" style="float:left;width:97px;height:104px;"><img src="img/Unimelb.png" alt="Uni logo" style="float:right;width:97px;height:104px;"><b>Melbourne School of Psychological Sciences<br><br>
                Consent form for persons participating in a research project</b><br>
            </p>   

            <p align="center">PROJECT TITLE: <i><b>Identifying causes of events</b></i><br><br>
            </p>      
            <hr/>
            <p align="center"><b>Aurélien Fermo (Responsible Researcher)<br></b>
                Tel: +33 642 249 420; email: aurelien.fermo@ens.fr<br>
                <b>A/Prof Charles Kemp (co-researcher)</b> email: c.kemp@unimelb.edu
			</p>
            <hr/><br>
			<ol>
                <li>I consent to participate in this project. The purpose of this research is to acquire information about how people make causal judgments.</li>
                <br>
                <li>I understand that this project is for research purposes only. It is expected that the results of this study will be presented at conferences and published in a peer-reviewed journal.</li>
                <br>
                <li>In this project I will be given some optional demographic questions and then shown a series of animations wich will depict interconnected nodes being activated. For each animation I will be asked to click on the node I will consider the main cause of the activation of the final node. The details of this have been explained in the statement on the previous page.</li>
                <br>
                <li>I understand that there are risks involved in participating in this research project, although they are minimal; the largest risk is of some degree of boredom. The study is estimated to take ten minutes or so.</li>
                <br>
                <li>My participation is voluntary and I am free to withdraw from the project at any time without explanation or prejudice and to withdraw any unprocessed data I have provided. Withdrawing from the project will not affect my relationship with any person.</li>
                <br>
                <li>I have been informed that the data from this research will be stored at the University of Melbourne and may be made available in de-identified form to the scientific community.</li>
                <br>
                <li>I have been informed that the confidentiality of the information I provide will be safeguarded subject to any legal requirements. My data is anonymous and not linked to any personal information at any time. </li>
            </ol>
            <br>
            <p>By clicking the “Next” button I give my consent to participate in this project.</p>
            <br>
            <p align="center">
                <input type="button" id="consentButton" class="consent jspsych-btn" value="Next >" onclick="consentButtonClick()" >
			</p>

		</div>
        <br><br>
    </div>

        	<!-- ####################### Demographics ####################### -->

	<div class="demographics" style="display:none; text-align:center; width: 800px; margin:auto; padding:200px 0;">
		<div class="demographics" style="text-align:justify; border:0px solid; width:800px; font-size:90%; float:right">
			<!-- Explanatory text -->
            <p font-size:110%><b>Demographic information:</b></p>
			<p>
                We need this information for our records, but it is kept completely separate from
                information about your Amazon ID. As long as you finish the experiment you will get
                paid no matter what you put here, so please be honest.
            </p><br>

			<!-- Gender -->
	 		<label for="gender"><b>Gender: &nbsp;</b></label>
	  		<input type="radio" name="gender" value="male" /> Male &nbsp;
	  		<input type="radio" name="gender" value="female" /> Female &nbsp;
	  		<input type="radio" name="gender" value="other" /> Other<br /><br />

			<!-- Age -->
	  		<label for="age"><b>Age: &nbsp;</b></label><input id="age" name="age" /><br /><br />

			<!-- Language -->
	  		<label for="language"><b>Native Language(s): &nbsp;</b></label>
            <input id="language" name="language" /><br /><br />

			<!-- Country -->
			<label for="country"><b>Country you live in: &nbsp;</b></label>
	  		<select name="country" id="country" class='drop-menu'>
	    		<option>Afghanistan</option>
                <option>&Aring;land Islands</option>
                <option>Albania</option>
                <option>Algeria</option>
                <option>American Samoa</option>
                <option>Andorra</option>
                <option>Angola</option>
                <option>Anguilla</option>
                <option>Antarctica</option>
                <option>Antigua and Barbuda</option>
                <option>Argentina</option>
                <option>Armenia</option>
                <option>Aruba</option>
                <option selected="selected">Australia</option>
                <option>Austria</option>
                <option>Azerbaijan</option>
                <option>Bahamas</option>
                <option>Bahrain</option>
                <option>Bangladesh</option>
                <option>Barbados</option>
                <option>Belarus</option>
                <option>Belgium</option>
                <option>Belize</option>
                <option>Benin</option>
                <option>Bermuda</option>
                <option>Bhutan</option>
                <option>Bolivia</option>
                <option>Bosnia and Herzegovina</option>
                <option>Botswana</option>
                <option>Bouvet Island</option>
                <option>Brazil</option>
                <option>British Indian Ocean territory</option>
                <option>Brunei Darussalam</option>
                <option>Bulgaria</option>
                <option>Burkina Faso</option>
                <option>Burundi</option>
                <option>Cambodia</option>
                <option>Cameroon</option>
                <option>Canada</option>
                <option>Cape Verde</option>
                <option>Cayman Islands</option>
                <option>Central African Republic</option>
                <option>Chad</option>
                <option>Chile</option>
                <option>China</option>
                <option>Christmas Island</option>
                <option>Cocos (Keeling) Islands</option>
                <option>Colombia</option>
                <option>Comoros</option>
                <option>Congo</option>
                <option>Congo, Democratic Republic</option>
                <option>Cook Islands</option>
                <option>Costa Rica</option>
                <option>C&ocirc;te d'Ivoire (Ivory Coast)</option>
                <option>Croatia (Hrvatska)</option>
                <option>Cuba</option>
                <option>Cyprus</option>
                <option>Czech Republic</option>
                <option>Denmark</option>
                <option>Djibouti</option>
                <option>Dominica</option>
                <option>Dominican Republic</option>
                <option>East Timor</option>
                <option>Ecuador</option>
                <option>Egypt</option>
                <option>El Salvador</option>
                <option>Equatorial Guinea</option>
                <option>Eritrea</option>
                <option>Estonia</option>
                <option>Ethiopia</option>
                <option>Falkland Islands</option>
                <option>Faroe Islands</option>
                <option>Fiji</option>
                <option>Finland</option>
                <option>France</option>
                <option>French Guiana</option>
                <option>French Polynesia</option>
                <option>French Southern Territories</option>
                <option>Gabon</option>
                <option>Gambia</option>
                <option>Georgia</option>
                <option>Germany</option>
                <option>Ghana</option>
                <option>Gibraltar</option>
                <option>Greece</option>
                <option>Greenland</option>
                <option>Grenada</option>
                <option>Guadeloupe</option>
                <option>Guam</option>
                <option>Guatemala</option>
                <option>Guinea</option>
                <option>Guinea-Bissau</option>
                <option>Guyana</option>
                <option>Haiti</option>
                <option>Heard and McDonald Islands</option>
                <option>Honduras</option>
                <option>Hong Kong</option>
                <option>Hungary</option>
                <option>Iceland</option>
                <option>India</option>
                <option>Indonesia</option>
                <option>Iran</option>
                <option>Iraq</option>
                <option>Ireland</option>
                <option>Israel</option>
                <option>Italy</option>
                <option>Jamaica</option>
                <option>Japan</option>
                <option>Jordan</option>
                <option>Kazakhstan</option>
                <option>Kenya</option>
                <option>Kiribati</option>
                <option>Korea (north)</option>
                <option>Korea (south)</option>
                <option>Kuwait</option>
                <option>Kyrgyzstan</option>
                <option>Lao People's Democratic Republic</option>
                <option>Latvia</option>
                <option>Lebanon</option>
                <option>Lesotho</option>
                <option>Liberia</option>
                <option>Libyan Arab Jamahiriya</option>
                <option>Liechtenstein</option>
                <option>Lithuania</option>
                <option>Luxembourg</option>
                <option>Macao</option>
                <option>Macedonia, Former Yugoslav Republic Of</option>
                <option>Madagascar</option>
                <option>Malawi</option>
                <option>Malaysia</option>
                <option>Maldives</option>
                <option>Mali</option>
                <option>Malta</option>
                <option>Marshall Islands</option>
                <option>Martinique</option>
                <option>Mauritania</option>
                <option>Mauritius</option>
                <option>Mayotte</option>
                <option>Mexico</option>
                <option>Micronesia</option>
                <option>Moldova</option>
                <option>Monaco</option>
                <option>Mongolia</option>
                <option>Montenegro</option>
                <option>Montserrat</option>
                <option>Morocco</option>
                <option>Mozambique</option>
                <option>Myanmar</option>
                <option>Namibia</option>
                <option>Nauru</option>
                <option>Nepal</option>
                <option>Netherlands</option>
                <option>Netherlands Antilles</option>
                <option>New Caledonia</option>
                <option>New Zealand</option>
                <option>Nicaragua</option>
                <option>Niger</option>
                <option>Nigeria</option>
                <option>Niue</option>
                <option>Norfolk Island</option>
                <option>Northern Mariana Islands</option>
                <option>Norway</option>
                <option>Oman</option>
                <option>Pakistan</option>
                <option>Palau</option>
                <option>Palestinian Territories</option>
                <option>Panama</option>
                <option>Papua New Guinea</option>
                <option>Paraguay</option>
                <option>Peru</option>
                <option>Philippines</option>
                <option>Pitcairn</option>
                <option>Poland</option>
                <option>Portugal</option>
                <option>Puerto Rico</option>
                <option>Qatar</option>
                <option>R&eacute;union</option>
                <option>Romania</option>
                <option>Russian Federation</option>
                <option>Rwanda</option>
                <option>Saint Helena</option>
                <option>Saint Kitts and Nevis</option>
                <option>Saint Lucia</option>
                <option>Saint Pierre and Miquelon</option>
                <option>Saint Vincent and the Grenadines</option>
                <option>Samoa</option>
                <option>San Marino</option>
                <option>Sao Tome and Principe</option>
                <option>Saudi Arabia</option>
                <option>Senegal</option>
                <option>Serbia</option>
                <option>Seychelles</option>
                <option>Sierra Leone</option>
                <option>Singapore</option>
                <option>Slovakia</option>
                <option>Slovenia</option>
                <option>Solomon Islands</option>
                <option>Somalia</option>
                <option>South Africa</option>
                <option>South Georgia and the South Sandwich Islands</option>
                <option>Spain</option>
                <option>Sri Lanka</option>
                <option>Sudan</option>
                <option>Suriname</option>
                <option>Svalbard and Jan Mayen Islands</option>
                <option>Swaziland</option>
                <option>Sweden</option>
                <option>Switzerland</option>
                <option>Syria</option>
                <option>Taiwan</option>
                <option>Tajikistan</option>
                <option>Tanzania</option>
                <option>Thailand</option>
                <option>Togo</option>
                <option>Tokelau</option>
                <option>Tonga</option>
                <option>Trinidad and Tobago</option>
                <option>Tunisia</option>
                <option>Turkey</option>
                <option>Turkmenistan</option>
                <option>Turks and Caicos Islands</option>
                <option>Tuvalu</option>
                <option>Uganda</option>
                <option>Ukraine</option>
                <option>United Arab Emirates</option>
                <option>United Kingdom</option>
                <option>United States of America</option>
                <option>Uruguay</option>
                <option>Uzbekistan</option>
                <option>Vanuatu</option>
                <option>Vatican City</option>
                <option>Venezuela</option>
                <option>Vietnam</option>
                <option>Virgin Islands (British)</option>
                <option>Virgin Islands (US)</option>
                <option>Wallis and Futuna Islands</option>
                <option>Western Sahara</option>
                <option>Yemen</option>
                <option>Zaire</option>
                <option>Zambia</option>
                <option>Zimbabwe</option>
	    	</select>

			<br>
		<br><br>

		<!-- Demographics  button -->
        <p align="center">
                <input type="button" class="demographics jspsych-btn" id="demographicsButton" value="Next >"
                       onclick="demographicsButtonClick()">
       </p>
    </div>

    </body>
    <script>

    //var txt_prompt = "<p align='center'>Pick out the detector that is the main cause of the activation of the GCM</p>";
    var txt_prompt = "Pick out the detector that is the main cause of the activation of the GCM";
    var coord_chain = [[19,245],[94,245],[170,245],[245,245],[321,245],[396,245],[472,245],[547,245]];
    var coord_branch_R = [[19,189],[94,189],[170,189],[245,189],[321,189],[396,189],[472,189],[19,302],[94,302],[170,302],[245,302],[321,302],[396,302],[472,302],[547,245]];
    var coord_branch_L = [[19,245],[94,189],[170,189],[245,189],[321,189],[396,189],[472,189],[547,189],[94,302],[170,302],[245,302],[321,302],[396,302],[472,302],[547,302]];
    var img_R = ["img/chain_Right.png", "img/chain_Right.png", "img/chain_Right.png","img/branch_SSR0.png", "img/branch_MSR0.png", "img/branch_LSR0.png","img/branch_SER0.png", "img/branch_SER0.png", "img/branch_SER0.png", "img/branch_MER0.png", "img/branch_MER0.png", "img/branch_MER0.png", "img/branch_LER0.png", "img/branch_LER0.png", "img/branch_LER0.png"];
    var gif_R = ["img/chain_SR.gif", "img/chain_MR.gif", "img/chain_LR.gif", "img/branch_SSR.gif", "img/branch_MSR.gif", "img/branch_LSR.gif", "img/branch_SER1.gif","img/branch_SER2.gif", "img/branch_SER3.gif", "img/branch_MER1.gif", "img/branch_MER2.gif", "img/branch_MER3.gif", "img/branch_LER1.gif", "img/branch_LER2.gif", "img/branch_LER3.gif"];
    var img_L = ["img/chain_Left.png", "img/chain_Left.png", "img/chain_Left.png", "img/branch_SSL0.png", "img/branch_MSL0.png", "img/branch_LSL0.png","img/branch_SEL0.png", "img/branch_SEL0.png", "img/branch_SEL0.png", "img/branch_MEL0.png", "img/branch_MEL0.png", "img/branch_MEL0.png", "img/branch_LEL0.png", "img/branch_LEL0.png", "img/branch_LEL0.png"];
    var gif_L = ["img/chain_SL.gif", "img/chain_ML.gif", "img/chain_LL.gif", "img/branch_SSL.gif", "img/branch_MSL.gif", "img/branch_LSL.gif", "img/branch_SEL1.gif", "img/branch_SEL2.gif", "img/branch_SEL3.gif", "img/branch_MEL1.gif", "img/branch_MEL2.gif", "img/branch_MEL3.gif", "img/branch_LEL1.gif", "img/branch_LEL2.gif", "img/branch_LEL3.gif"];

    var group = ["Right","Left"];
    var condition = group[Math.floor(Math.random()*group.length)];
    if(condition == "Right"){
        var images = img_R;
        var animations = gif_R;
        var coord_branch = coord_branch_R;
        var inst_4 = "img/inst_4R.gif";
    }
    if(condition == "Left"){
        var images = img_L;
        var animations = gif_L;
        var coord_branch = coord_branch_L;
        var inst_4 = "img/inst_4L.gif";
    }

    var timeline = [];
    var introloop=[];
    var turkcode = (Math.floor(Math.random() * 899999) + 100000).toString(); // generate completion code

    // get the value of a radio button
    function getRadioButton(name) {
        var i, radios = document.getElementsByName(name);
        for (i = 0; i < radios.length; i = i + 1) {
            if (radios[i].checked) {
                return (radios[i].value);
            }
        }
    return("NA")
    }

    function setDisplay(theClass, theValue) {
            var i, classElements = document.getElementsByClassName(theClass);
            for (i = 0; i < classElements.length; i = i + 1) {
                classElements[i].style.display = theValue;
            }
        }

    function splashButtonClick() {
            setDisplay('start', 'none');
            setDisplay('plain-language-statement', '');
        }

    function plsButtonClick() {
        setDisplay('plain-language-statement', 'none');
        setDisplay('consent', '');
    }

    function consentButtonClick() {
        setDisplay('consent', 'none');
        setDisplay('demographics', '');
    }

    /* save and finish */
    function endExperiment(dataset,callback) {
        //$.post('submit',{"content": dataset});
        setTimeout(callback,1000)

    }

    function startExperiment(){
    
        jsPsych.init({
            timeline: timeline,
            preload_images: [img_R,img_L,gif_R,gif_L],
            /*
            on_finish: function() {
                //jsPsych.data.displayData();
            }*/
            on_finish: function() {
                endExperiment(jsPsych.data.dataAsCSV(), function() {
                    document.write('<div id="endscreen" class="endscreen" style="width:1000px"><div class="endscreen" style="text-align:center; border:0px solid; padding:10px; font-size:120%; width:800px; float:right"><p><br><br><br>All done!<br><br>Your completion code is <span id="turkcode" style="font-weight:bold;font-size:130%">' + turkcode + '</span>. To receive payment for the HIT, return to the Amazon Mechanical Turk page and enter this code. Please contact us if something goes wrong and we\'ll fix it as quickly as possible.</p></div></div>')
                    }
                )
            }
        });  
    }

    function demographicsButtonClick() {
        setDisplay('demographics', 'none');
        setDisplay('header','none');

        jsPsych.data.addProperties({
            gender: getRadioButton("gender"),
            age: document.getElementById("age").value,
            language: document.getElementById("language").value,
            country: document.getElementById("country").value
        });


        // record the condition assignment in the jsPsych data
        jsPsych.data.addProperties({
            sampling: condition,
            turkcode: turkcode
        });

        startExperiment();
    }

    var instructions = {
          type: "image-button-response",
          timing_post_trial: 0,
	      button_html: '<button class="jspsych-btn">%choice%</button>',
          choices: ['Click here to continue'],
          //on_trial_start: function() { setTimeout(function() {setDisplay("jspsych-btn","")}, 3000)},
          is_html: true,
          timeline: [
              {stimulus: "img/inst_1.png"},
              {stimulus: "img/inst_2.png"},
              {stimulus: "img/inst_3.png"},
              {stimulus: inst_4},
              {stimulus: "img/inst_5.png"},
              {stimulus: "img/inst_6.png"}
          ]
      };
    introloop.push(instructions);

    
    //var instructioncorrect = false;
    var instructioncorrect = false;
    var instruction_check1 = {
        type: "survey-multi-choice",
        preamble: ["<p align='center'><b>Check your knowledge before you begin !</b></p>"],
        button_label: "Submit Answers",
        questions: [
            {prompt:"<b>Question 1</b>: What is your goal in this task ?", options:[" To find out if the Gauge of Crtical Moment (GCM) is activated or not"," To find out the cause of the activation of each detector"," To find out which detector is the main cause of the activation of a GCM"],required:true},
            {prompt:"<b>Question 2</b>: How to recognize a GCM ?", options:[" A GCM is a square marked with a star", "A GCM is a square without any mark"],required:true},
            {prompt:"<b>Question 3</b>: What is the difference between a GCM-chain and a GCM-branch ?", options:[" To be activated a GCM-chain has to receive signals from only one inactive detector whereas a GCM-branch from necessarily two inactive detectors"," To be activated a GCM-chain has to receive signals from necessarily two activated detectors whereas a GCM-branch from only one activated detector"," To be activated a GCM-chain has to receive signals from only one activated detector whereas a GCM-branch from necessarily two activated detectors"],required:true},
            {prompt:"<b>Question 4</b>: Stick the correct statement", options:[" You are required to assign a number to each detector"," You have to click on only one detector"," Not all detectors are clickable"],required:true}
        ],
        on_finish: function(data) {

            if( data.responses == '{"Q0":" To find out which detector is the main cause of the activation of a GCM","Q1":" A GCM is a square marked with a star","Q2":" To be activated a GCM-chain has to receive signals from only one activated detector whereas a GCM-branch from necessarily two activated detectors","Q3":" You have to click on only one detector"}') {
                action = false;
                instructioncorrect = true;
            }

            //console.log(hack)
        }
    }
    introloop.push(instruction_check1)

    
    var width = 605;
    var height = 529;

    /*
    var instruction_check2 = {
        type: 'causal-graph1',
        stimulus: "img/check_click.png",
        stim_width: width,
        stim_height: height,
        nodes_coord: [[132,328],[181,249],[204,407],[260,317],[287,192],[328,434],[366,268],[396,358]],
        button_label_next: "Submit Answers"
    }
    
    introloop.push(instruction_check2);
    */

    var showsplash = true;
    var splash_screen = {
        type: 'image-button-response',
        timing_post_trial: 0,
	    button_html: '<button class="jspsych-btn">%choice%</button>',
        choices: ['Click here to read the instructions again'],
        //on_trial_start: function() { setTimeout(function() {setDisplay("jspsych-btn","")}, 1000)},
        is_html: true,
        stimulus: 'img/inst_7.png'
    }

    var conditional_splash = {
        timeline: [splash_screen],
        conditional_function: function(data) {
            return !instructioncorrect // skip if correct
        }
    }
    introloop.push(conditional_splash)

    var loop_node = {
        timeline: introloop,
        loop_function: function(data) {
            //var action = true;
            return !instructioncorrect // stop looping if correct
        }
    }
    timeline.push(loop_node)


    /* success trial */
    var successtrial = {
        type: 'image-button-response',
        timing_post_trial: 0,
	    button_html: '<button class="jspsych-btn">%choice%</button>',
        choices: ['Click here to begin'],
        //on_trial_start: function() { setTimeout(function() {setDisplay("jspsych-btn","")}, 1000)},
        is_html: true,
        stimulus: "img/inst_8.png"
    };
    timeline.push(successtrial);

    //var gif = ["img/chain_S", "img/chain_M", "img/chain_L", "img/branch_SS", "img/branch_MS", "img/branch_LS"];
     
    var chain_S = [];
    var chain_M = [];
    var chain_L = [];
    var branch_SS = [];
    var branch_MS = [];
    var branch_LS = [];
    var branch_SE1 = [];
    var branch_SE2 = [];
    var branch_SE3 = [];
    var branch_ME1 = [];
    var branch_ME2 = [];
    var branch_ME3 = [];
    var branch_LE1 = [];
    var branch_LE2 = [];
    var branch_LE3 = [];
    var all_trials = [chain_S,chain_M,chain_L,branch_SS,branch_MS,branch_LS,branch_SE1,branch_SE2,branch_SE3,branch_ME1,branch_ME2,branch_ME3,branch_LE1,branch_LE2,branch_LE3];

    for(var i=0; i < all_trials.length; i++){
        if(i<3){
            var coord = coord_chain;
        } else {
            var coord = coord_branch;
        }
        var graph_img = {
            type: 'causal-graph-inactive',
            stimulus: images[i],
            stim_width: width,
            stim_height: height,
            prompt: txt_prompt
        }
        var graph_gif = {
            type: 'causal-graph1',
            stimulus: animations[i],
            stim_width: width,
            stim_height: height,
            nodes_coord: coord,
            prompt: txt_prompt,
            button_label_again: "Run again",
            button_label_next: "Next graph"
        }
        var graph_loop = {
            timeline: [graph_gif],
            loop_function: function(data){
                var again = data.values()[0].again;
                if(again == 1){
                    return true;
                } else {
                    return false;
                }
            }
        }
        all_trials[i].push(graph_img, graph_loop);
    }

    // var all_trials = [chain_S_loop, chain_M_loop, chain_L_loop, branch_SS_loop, branch_MS_loop, branch_LS_loop];
    var all_trials_rand = jsPsych.randomization.repeat(all_trials, 1);

    for (var i=0; i < all_trials_rand.length; i++) {
        timeline.push(all_trials_rand[i][0]);
        timeline.push(all_trials_rand[i][1]);
    }

    var txt_fin = "<div class='debriefing-statement' style='text-align:justify; border:0px solid; padding:10px;  width:800px; font-size:14px; line-height:normal; font-family:initial; float:right'>"+
        "<p align='center' style='font-size: 19px;'><img src='img/Unimelb.png' alt='Uni logo' style='float:left;width:97px;height:104px;'>"+
        "<img src='img/Unimelb.png' alt='Uni logo' style='float:right;width:97px;height:104px;'><b>Melbourne School of Psychological Sciences<br><br>Debriefing Statement</b><br></p>"+
        "<p align='center'>PROJECT TITLE: <i><b>Identifying causes of events</b></i><br><br></p>"+ 
        "<hr/>"+
        "<p align='center'><b>Aurélien Fermo (Responsible Researcher)<br></b>"+
        "Tel: +33 642 249 420; email: aurelien.fermo@ens.fr<br>"+
        "<b>A/Prof Charles Kemp (co-researcher)</b> email: c.kemp@unimelb.edu</p>"+
        "<hr/><br>"+
		"<p align='center'><b>Thank you for participating in our study !</b></p>"+
		"<p>The study was pretty straightforward so there’s not much more to say, but in case you’re interested in more of the background, here it is:"+
        "<br><br>As mentioned at the beginning of this experiment, we are interested in understanding how people identify the cause or causes of an effect. Two existing theories make predictions about these judgments. Suppose for example that Suzy throws a rock at a bottle and breaks it. One approach states that if Suzy hadn't thrown the rock, the bottle wouldn't have shattered, and then concludes that Suzy's throw is the cause of the bottle shattering. The other approach says that Suzy’s throw caused the bottle to shatter because the rock transmitted energy to the bottle."+
        "<br><br>The two theories agree in this simple example but in other contexts they disagree. For instance, suppose that Suzy is piloting a bomber with the goal of destroying an enemy target. On her trajectory she meets an enemy fighter aircraft that is about to intercept her, but Bob who is escorting her shoots the enemy and Suzy succeeds in destroying the target. The first theory states that Bob's action is a cause of the destruction of the target, but the second one states that the only cause of the target’s destruction is Suzy's action, because this is the only action physically connected to the dropping of the bomb. If you are interested in these two competing theories, you can read more <a href= https://www.andrew.cmu.edu/user/ddanks/papers/SingularCause-Final.pdf target='_blank'>here</a>"+
        "<br><br>The experiment you just did is designed to test a new theory of causation that focuses on changes of state. An effect (e.g. the activation of a detector) is a change of state, and we propose that when an effect occurs people identify a sequence of changes that led to the effect, and identify the first change in the sequence as the primary cause of the effect. In some cases this theory makes predictions that differ from the two standard theories already described, and the experiment you did includes questons that are designed to distinguish between these competing theories"+
        "<br><br>As always we are very grateful for your thoughtful responses, as they tell us a great deal about how humans think and reason.</p>"+
        "<br><br>"+
        "<p style='font-size: 12px;'>This research has been cleared by the Human Research Ethics Committee (HREC ? If you have any concerns about this project please contact the Executive Officer, Human Research Ethics, The University of Melbourne (Tel: 8344 2073; Fax: 9347 6739).</p>"+
        "</div>"

    var finish = {
        type: 'html-button-response',
        stimulus: txt_fin,
        choices: ['Finish']
    }

    timeline.push(finish);

    </script>
</html>
